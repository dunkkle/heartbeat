<!DOCTYPE html>
<html>
<head>
	<!-- Makes this work on mobile devices without being super zoomed out -->
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<title>heart beats</title>

	<!--  Sources! -->
	<!-- 
		https://github.com/daneden/animate.css/blob/master/animate.css 
		https://css-tricks.com/examples/ShapesOfCSS/
		https://css-tricks.com/snippets/css/a-guide-to-flexbox/
		http://stackoverflow.com/questions/8473162/how-do-i-set-height-of-container-div-to-100-of-window-height
		https://github.com/aterrien/jQuery-Knob
		-->

	<link href="https://fonts.googleapis.com/css?family=Dawning+of+a+New+Day" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Dosis:200" rel="stylesheet">

	<style type="text/css" id="0">

		/* Basic Layout */

		body {
			background-color: #232323;
			height: 100vh;
		}
		
		.main-container {
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			flex-direction: column;
		}

		.heart-container {
			width: 300px;
			height: 200px;
			display: flex;
			justify-content: center;
		}

		.text-container {
			height: 100px;
			width: 300px;
			color: white;
			color: #F4F2F6;
			text-align: center;
			font-family: 'Dosis', sans-serif;
			font-size: 20px;
		}

		.dial-container {
			font-size: 20px;
			bottom: 0;
		}

		input.dial {
			font-size: 32px !important;
			margin-top: 24px !important;
		}


		/* Heart */

		#heart {
		    position: relative;
		    width: 100px;
		    height: 90px;
		    align-self: center;
		}
		#heart:before,
		#heart:after {
		    position: absolute;
		    content: "";
		    left: 50px;
		    top: 0;
		    width: 50px;
		    height: 80px;
		    background: #F364B4;
		    -moz-border-radius: 50px 50px 0 0;
		    border-radius: 50px 50px 0 0;
		    -webkit-transform: rotate(-45deg);
		       -moz-transform: rotate(-45deg);
		        -ms-transform: rotate(-45deg);
		         -o-transform: rotate(-45deg);
		            transform: rotate(-45deg);
		    -webkit-transform-origin: 0 100%;
		       -moz-transform-origin: 0 100%;
		        -ms-transform-origin: 0 100%;
		         -o-transform-origin: 0 100%;
		            transform-origin: 0 100%;
		    -webkit-animation-name: colorchange;
			        animation-name: colorchange;
			-webkit-animation-duration: 1.1s;
					animation-duration: 1.1s;
			-webkit-animation-fill-mode: both;
					animation-fill-mode: both;
			-webkit-animation-iteration-count: infinite;
					animation-iteration-count: infinite;
		}
		#heart:after {
		    left: 0;
		    -webkit-transform: rotate(45deg);
		       -moz-transform: rotate(45deg);
		        -ms-transform: rotate(45deg);
		         -o-transform: rotate(45deg);
		            transform: rotate(45deg);
		    -webkit-transform-origin: 100% 100%;
		       -moz-transform-origin: 100% 100%;
		        -ms-transform-origin: 100% 100%;
		         -o-transform-origin: 100% 100%;
		            transform-origin: 100% 100%;
		}


		/* Animation Basics */

		.animated {
		  -webkit-animation-duration: 1.1s;
		  		  animation-duration: 1.1s;
		  -webkit-animation-fill-mode: both;
		  		  animation-fill-mode: both;
		}

		.animated.infinite {
		  -webkit-animation-iteration-count: infinite;
		  		  animation-iteration-count: infinite;
		}

		/* Pulse Animation */
			@-webkit-keyframes pulse {
			  0% {
			    -webkit-transform: scale3d(1, 1, 1);
			    		transform: scale3d(1, 1, 1);
			  }

			  27% {
			    -webkit-transform: scale3d(1.3, 1.3, 1.3);
			    		transform: scale3d(1.3, 1.3, 1.3);
			  }

			  100% {
			    -webkit-transform: scale3d(1, 1, 1);
			    		transform: scale3d(1, 1, 1);
			  }
			}

		@keyframes pulse {
		  0% {
		    -webkit-transform: scale3d(1, 1, 1);
		    		transform: scale3d(1, 1, 1);
		  }

		  27% {
		    -webkit-transform: scale3d(1.3, 1.3, 1.3);
		    		transform: scale3d(1.3, 1.3, 1.3);
		  }

		  100% {
		    -webkit-transform: scale3d(.95, 1, 1);
		   			transform: scale3d(.95, 1, 1);
		  }
		}

		.pulse {
		  -webkit-animation-name: pulse;
		  		  animation-name: pulse;
		}

		@keyframes colorchange {
			from {
				background: #bf1c76;
			}

			9% {
				background: #F364B4;
			}

			27% {
				background: #f24ba7;
			}

			to {
				background: #bf1c76;
			}
		}

	</style>

	 <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
     <script src="./jquery.knob.min.js"></script>
</head>


<body>

<div class="main-container">
	
	<div class="heart-container">
		<div id="heart" class="animated infinite pulse colorchange"></div>
	</div>

	<div class="text-container">
		heartbeats
	</div>
	<div class="dial-container">
		<input type="text" class="dial" value=25>
	</div>

</div>

<script type="text/javascript">
		
		$(".dial").knob({
	    // set up the dial options (most of them)
	    'min':20,
	    'max':200,
	    'angleArc': 100,
	    'angleOffset': 310,
	    'lineCap': "round",
	    'inputColor': "#f2f2f2",
	    'fgColor': "#F364B4",
	    'displayInput': true,
	    'cursor': true,
	    'font': "Dosis",
	    'thickness': .12,
	    'width': 200,
	    'height': 100,
	    // ok, so what happens when a value gets set? Let's do some ECMAScripting!
	    'release': function(value) {
	    	var beatsPerMinute = value;

	    	// round animationDuration to nearest tenth
	    	var beatsPerSecond = (Math.round((value / 60 ) * 10) / 10).toFixed(2);
	    	
	    	// animation duration  = seconds per beat!
	    	var animationDuration = (Math.round((1/beatsPerSecond) *10) / 10).toFixed(2) + "s";

	    	// need !important tag here, I guess -- color changing wasn't working without it.
	    	var animationDurationColor = animationDuration + " !important";

	    	// console.log(value);
	    	// console.log("Animation Duration: " + animationDuration);
			// console.log(document.styleSheets[0]);
	    	
	    	// Change animation duration for pulse
	    	var heartShape = document.getElementsByClassName("animated");
	    
	    	// apparently you can access webkit prefixes by capitalizing the first letter instead of doing normal camelCase
	    	 heartShape[0].style.webkitAnimationDuration = animationDuration;
	    	// document.getElementById('heart').style.webkitAnimationDuration = animationDuration;

	    	// WATCH OUT! STUPID HACK! This triggers a DOM repaint or something. Now it works in Safari. Yay.	
			$('#heart').css("-webkit-animation-duration", animationDuration).hide().show(0);
	    	// heartShape[0].style.animationDuration = animationDuration;


	    	console.log(animationDuration);

	    	// Change animation duration for color change. This is a weird way to do it,
	    	// but necessary because of the pseudo selectors in play here.
	    	document.styleSheets[0].addRule('#heart:before, #heart:after','-webkit-animation-duration:'+animationDurationColor+';');
	    	document.styleSheets[0].addRule('#heart:before, #heart:after','animation-duration:'+animationDurationColor+';');


	    	// 
	    	// Ok, last thing. This should fix the issue where Safari (Mac and iOS) does not seem 
	    	// to 'get' the change to the pulse rate. It was changing the color rate just fine, 
	    	// but the pulse wouldn't update. Turns out that there's an issue where Safari needs 
	    	// help with 'frame refresh'. It needs to be told to repaint the DOM. 
	    	// Source: http://www.eccesignum.org/blog/solving-display-refreshredrawrepaint-issues-in-webkit-browsers
	    	//


	    	// Set the scale of the element to 1. Doesn't actually change anything visually
	    	// because by default everything is set to scale 1.

	    	// document.getElementsByClassName('.heart-container').style.webkitTransform = 'scale(1)';

	    	/*	Silently append and remove a text node	
	    		This is the fix that worked for me in the Phonegap/Android application
	    		the setTimeout allows a 'tick' to happen in the browser refresh,
	    		giving the UI time to update
	    	*/
	    	// var n = document.createTextNode(' ');
	    	// $('#heart').append(n);
	    	// setTimeout(function(){n.parentNode.removeChild(n)}, 0);


	    }
	});


</script>

</body>
</html>